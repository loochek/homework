call main
hlt

main:
    push 0
    pop rrx
    
rad_loop:
    push rrx
    push 60
    jg loop_end
    
    ; push radius
    push rrx
    ;push color
    push rrx
    push rrx
    push 10
    push 256
    push 256
    mul
    mul
    mul
    push rrx
    push 20
    push 256
    mul
    mul
    push rrx
    push 30
    mul
    add
    add
    call draw_circle
    
    pop rrx
    
    push rrx
    push 1
    add
    pop rrx
    jmp rad_loop
    
loop_end:
    fbupd
    ret
    

draw_circle:
    pop rdx
    pop rcx
    pop rrx
    push rdx
    
    push 0
    pop rxx
    
draw_loop:
    ; for (rxx; rxx <= rrx * sin(45); rxx++)
    ; {
    push rxx
    push rrx
    push 0.7071 ; sin(45)
    mul
    jg draw_loop_end
    
    ; calculate y
    push rrx
    push rrx
    mul
    push rxx
    push rxx
    mul
    sub
    sqrt
    pop ryx
    
    ; draw 1/2
    
    push rxx
    push ryx
    
    push ryx
    push rxx
    call draw_square
    
    pop ryx
    pop rxx
    
    ; draw 2/2
    
    push rxx
    push ryx
    
    push rxx
    push ryx
    call draw_square
    
    pop ryx
    pop rxx
    
    ; draw end

    push rxx
    push 1
    add
    pop rxx
    jmp draw_loop
    ; }
    
draw_loop_end:
    ret
    
draw_square:
    pop rdx
    pop rxx
    pop ryx
    push rdx
    
    ; draw 1/4
    
    push ryx
    push rxx
    
    push ryx
    push rxx
    call draw
    
    pop rxx
    pop ryx
    
    ; draw 2/4
    
    push ryx
    push rxx
    
    push ryx
    push -1
    mul
    push rxx
    call draw
    
    pop rxx
    pop ryx
    
    ; draw 3/4
    
    push ryx
    push rxx
    
    push ryx
    push rxx
    push -1
    mul
    call draw
    
    pop rxx
    pop ryx
    
    ; draw 4/4
    
    push ryx
    push rxx
    
    push ryx
    push -1
    mul
    push rxx
    push -1
    mul
    call draw
    
    pop rxx
    pop ryx
    
    ; draw end
    
    ret

draw:
    pop rdx
    pop rxx
    pop ryx
    push rdx
    
    push 49152
    push ryx
    round
    push 64
    add
    push 128
    mul
    push rxx
    round
    push 64
    add
    add
    add
    pop rax
    
    push rcx
    pop [rax]
    
    ret
